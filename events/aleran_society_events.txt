namespace = aleran_society

#events designed to guide the player onto the right play path

#100s: inter-empire interactions
#400s: events that can happen due to being evil
#500s: events that can happen due to mismanagement
#1000s: actually dishing out the punishments

event = {
	id = aleran_society.100
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_country = {
			limit = {
				is_ai = no
				has_valid_civic = civic_dragon_gov
			}
			save_event_target_as = alerans
		}
		#log = "Ran AleranSoc 100, alerans are [event_target:alerans.GetName]"
		if = {
			limit = { exists = event_target:alerans }
			random_country = {
				limit = {
					is_country_type = default
					NOR = {
						is_same_value = root
						has_country_flag = aleran_contact_warduty
						has_country_flag = started_contact_war_prep_against
						has_valid_civic = civic_dragon_gov
						is_at_war_with = event_target:alerans
					}
					has_communications = event_target:alerans
					event_target:alerans = { has_casus_belli = {target = prev type = cb_dragon} }
				}
				save_event_target_as = empire
				set_country_flag = aleran_contact_warduty
			}
		}
		if = {
			limit = { exists = event_target:empire }
			#log = "Queued AleranSoc 102 via contact with [event_target:empire.GetName], CB is valid"
			event_target:alerans = { country_event = { id = aleran_society.102 days = 180 random = 180} } #was 30/30
		}
		else = {		
			#log = "AleranSoc 102, not valid; no target found"
		}
	}
}

event = {
	id = aleran_society.101
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_country = {
			limit = {
				is_ai = no
				has_valid_civic = civic_dragon_gov
			}
			save_event_target_as = alerans
		}
		#log = "Ran AleranSoc 101, alerans are [event_target:alerans.GetName]"
		if = {
			limit = { exists = event_target:alerans }
			random_country = {
				limit = {
					is_country_type = default
					NOR = {
						is_same_value = root
						has_country_flag = started_contact_war_prep_against
						has_country_flag = war_prompt_again
						has_valid_civic = civic_dragon_gov
						is_at_war_with = event_target:alerans
					}
					has_communications = event_target:alerans
					event_target:alerans = { has_casus_belli = {target = prev type = cb_dragon} }
				}
				save_event_target_as = empire
				set_timed_country_flag = { flag = war_prompt_again days = 5400 } #15y
			}
		}
		if = {
			limit = { exists = event_target:empire }
			#log = "Queued AleranSoc 102 via ambient comms with [event_target:empire.GetName], CB is valid"
			event_target:alerans = { country_event = { id = aleran_society.102 days = 360 random = 720} }
		}
		else = {		
			#log = "AleranSoc 102, not valid; no target found"
		}
	}
}

country_event = {
	id = aleran_society.102
	is_triggered_only = yes
	title = "aleran_society.102.name"
	#desc = "aleran_society.102.desc"
	desc = {
		trigger = {
			OR = { 
				NOT = { exists = event_target:empire }
				event_target:empire = {
					NOT = { has_country_flag = started_contact_war_prep_against }
				}
			}
		}
		text = aleran_society.102.desc
	}
	desc = {
		trigger = {
			exists = event_target:empire
			event_target:empire = {
				NOT = { has_country_flag = started_contact_war_prep_against }
				has_country_flag = war_prompt_again
			}
		}
		text = aleran_society.102.desc3
	}
	desc = {
		trigger = {
			exists = event_target:empire
			event_target:empire = {
				has_country_flag = started_contact_war_prep_against
			}
		}
		text = aleran_society.102.desc2
	}
	picture = GFX_evt_throne_room
	show_sound = event_factions
	
	immediate = {	
		#log = "- FromFrom: [From.From.GetName]"
		#log = "- FromFromFrom: [From.From.From.GetName]"
		#log = "- FromFromFromFrom: [From.From.From.From.GetName]"
		if = {
			limit = {
				NOT = { has_technology = tech_corvettes }
			}
			give_technology = { tech = tech_corvettes message = yes }
		}
		remove_modifier = "aleran_no_navy"
	}
	
	option = {
		name = "aleran_society.102.click.a" #immediate war
		ai_chance = {
			factor = 150
		}
		owner = {
			declare_war = {
				target = event_target:empire
				name = "Aleran Duty"
				attacker_war_goal = wg_dragon
			}
			add_modifier = {
				modifier = moralistic_fervor_weak
				days = 3600
			}
		}
	}
	
	option = {
		name = "aleran_society.102.click.b" #delayed war
		ai_chance = {
			factor = 150
		}
		custom_tooltip = aleran_society.102.b.tooltip
		trigger = {
			event_target:empire = {
				NOT = { has_country_flag = started_contact_war_prep_against }
			}
		}
		owner = {
			if = {
				limit = {
					OR = {
						event_target:empire = { has_ethic = ethic_fanatic_xenophobe }
						event_target:empire = { has_ethic = ethic_fanatic_spiritualist }
						event_target:empire = { has_ethic = ethic_fanatic_militarist }
						AND = {
							event_target:empire = { has_ethic = ethic_militarist }
							OR = {
								event_target:empire = { is_spiritualist = yes}
								event_target:empire = { is_xenophobe = yes}
							}
						}
					}
				}
				add_modifier = {
					modifier = aleran_duty_dragfeet
					days = 900
				}
			}
			if = {
				limit = {
					#NOT = { has_country_flag = started_contact_war_prep }
					NOT = { has_modifier = aleran_contact_war_prepare }
				}
				add_modifier = {
					modifier = aleran_contact_war_prepare
					days = 900
				}
			}
			hidden_effect = {
				this = { country_event = { id = aleran_society.102 days = 900 } }
				#set_country_flag = started_contact_war_prep
				event_target:empire = { set_country_flag = started_contact_war_prep_against }
			}
		}
	}
	
	option = {
		name = "aleran_society.102.click.c" #ignore, "not bad enough"
		ai_chance = {
			factor = 150
		}
		
		trigger = {
			event_target:empire = {
				NOT = { has_country_flag = started_contact_war_prep_against }
			}
			OR = {
				event_target:empire = { has_ethic = ethic_fanatic_xenophile }
				event_target:empire = { 
					AND = {
						has_ethic = ethic_fanatic_materialist
						NOR = {
							has_ethic = ethic_xenophobe
						}
					}
				}
				event_target:empire = { 
					AND = {
						has_ethic = ethic_fanatic_egalitarian
						NOR = {
							has_ethic = ethic_spiritualist
							has_ethic = ethic_xenophobe
							has_ethic = ethic_militarist
						}
					}
				}
				event_target:empire = { 
					AND = {
						has_ethic = ethic_egalitarian
						NOR = {
							has_ethic = ethic_spiritualist
							has_ethic = ethic_xenophobe
							has_ethic = ethic_fanatic_spiritualist
							has_ethic = ethic_fanatic_xenophobe
							has_ethic = ethic_militarist
							has_ethic = ethic_fanatic_militarist
						}
					}
				}
			}
		}
		
		owner = {
			#hidden_effect = {
				add_modifier = { modifier = "aleran_no_navy" days = -1 }
			#}
		}
	}
	
	option = {
		name = "aleran_society.102.click.d" #ignore duty
		ai_chance = {
			factor = 150
		}
		
		allow = {
			custom_tooltip = {
				fail_text = "contact_empire_too_evil"		
				NOR = {
					event_target:empire = { has_valid_civic = civic_machine_terminator }
					event_target:empire = { has_valid_civic = civic_machine_assimilator }
					event_target:empire = { has_valid_civic = civic_barbaric_despoilers }
					event_target:empire = { has_valid_civic = civic_hive_devouring_swarm }
					event_target:empire = { has_valid_civic = civic_fanatic_purifiers }
					event_target:empire = {
						any_owned_pop_species = {
							OR = {
								AND = {
									has_citizenship_type = { country = event_target:empire type = citizenship_purge }
									OR = {
										has_purge_type = { country = event_target:empire type = purge_processing }		
										has_purge_type = { country = event_target:empire type = purge_matrix }		
										has_purge_type = { country = event_target:empire type = purge_normal }		
										has_purge_type = { country = event_target:empire type = purge_neutering }		
										has_purge_type = { country = event_target:empire type = purge_displacement }		
										has_purge_type = { country = event_target:empire type = purge_labor_camps }
									}									
								}
								AND = {
									has_citizenship_type = { country = event_target:empire type = citizenship_slavery }
									OR = {
										has_slavery_type = { country = event_target:empire type = slavery_livestock }
										has_slavery_type = { country = event_target:empire type = slavery_matrix }
										has_slavery_type = { country = event_target:empire type = slavery_domestic }
										has_slavery_type = { country = event_target:empire type = slavery_normal }
									}
								}
								OR = {
									has_living_standard  = { country = event_target:empire type = living_standard_servitude }
									has_living_standard  = { country = event_target:empire type = living_standard_none }
								}
							}				
						}
					}
				}
			}
		}
		owner = {
			add_modifier = {
				modifier = aleran_duty_ignore
				days = 7200
			}
		}
	}
}

#country_event = {
#	id = aleran_society.400
#	#hide_window = yes
#	#is_triggered_only = yes
#	title = "aleran_society.400.name"
#	desc = "aleran_society.400.desc"
#	picture = GFX_evt_throne_room
#	show_sound = event_factions
#	
#	trigger = {
#		has_valid_civic = civic_dragon_gov
#		is_ai = no
#		has_policy_flag = slavery_allowed
#	}
#
#	mean_time_to_happen = {
#		days = 180
#	}
#	
#	immediate = {		
#		save_event_target_as = alerans
#		capital_scope = {
#			solar_system = {
#				save_event_target_as = aleris
#			}
#		}	
#	}
#	
#	option = {
#		name = "aleran_society.400.click.a"
#		ai_chance = {
#			factor = 150
#		}
#		owner = {
#		
#		}
#	}
#}

country_event = {
	id = aleran_society.500
	#hide_window = yes
	#is_triggered_only = yes
	title = "aleran_society.500.name"
	desc = "aleran_society.500.desc"
	picture = GFX_evt_throne_room
	show_sound = event_factions
	
	trigger = {
		has_valid_civic = civic_dragon_gov
		is_ai = no
		always = no
		#any_owned_planet = {
		#	is_colony = yes
		#	happiness_planet < 20
		#}
	}

	mean_time_to_happen = {
		days = 180
	}
	
	immediate = {		
		save_event_target_as = alerans
		capital_scope = {
			solar_system = {
				save_event_target_as = aleris
			}
		}	
	}
	
	option = {
		name = "aleran_society.500.click.a"
		ai_chance = {
			factor = 150
		}
		owner = {
		
		}
	}
}

planet_event = {
	id = aleran_society.1530
	#hide_window = yes
	is_triggered_only = yes
	title = "aleran_society.1530.name"
	desc = "aleran_society.1530.desc"
	picture = GFX_evt_throne_room
	show_sound = event_factions
	
	immediate = {
		add_modifier = {
			modifier = disloyal_pops
			days = -1
		}
	}
	
	option = {
		name = "aleran_society.1530.click.a"
		ai_chance = {
			factor = 150
		}
		owner = {
		
		}
	}
}

planet_event = {
	id = aleran_society.1531
	#hide_window = yes
	is_triggered_only = yes
	title = "aleran_society.1531.name"
	desc = "aleran_society.1531.desc"
	picture = GFX_evt_throne_room
	show_sound = event_factions
	
	immediate = {	
		random_playable_country = {
			limit = {
				NOT = {prev = {has_casus_belli = {target = prev type = cb_dragon}}}
			}
			save_event_target_as = receiver
		}
		random_owned_planet = {
			limit = {
				 is_colony = yes
			}
			save_event_target_as = deserter #for mention in the description of the option button
			set_owner = event_target:receiver
		} 
	}
	
	option = {
		name = "aleran_society.1531.click.a"
		ai_chance = {
			factor = 150
		}
		owner = {
		
		}
	}
}

country_event = {
	id = aleran_society.1540
	#hide_window = yes
	is_triggered_only = yes
	title = "aleran_society.1540.name"
	desc = "aleran_society.1540.desc"
	picture = GFX_evt_throne_room
	show_sound = event_factions
	
	immediate = {
		random_owned_fleet = {
			limit = {
				any_owned_ship = {
					is_ship_class = shipclass_military
				}
			}
			every_owned_ship = {
				add_modifier = {
					modifier = disloyal_fleet
					days = -1
				}
			}
			save_event_target_as = disloyal #for mention in the description of the option button
		}
	}
	
	option = {
		name = "aleran_society.1540.click.a"
		ai_chance = {
			factor = 150
		}
		owner = {
		
		}
	}
}

country_event = {
	id = aleran_society.1541
	#hide_window = yes
	is_triggered_only = yes
	title = "aleran_society.1541.name"
	desc = "aleran_society.1541.desc"
	picture = GFX_evt_throne_room
	show_sound = event_factions
	
	immediate = {		
		random_owned_ship = {
			limit = {
				is_ship_class = shipclass_military
			}
			save_event_target_as = deserter #for mention in the description of the option button
			delete_ship = this
		} 
	}
	
	option = {
		name = "aleran_society.1541.click.a"
		ai_chance = {
			factor = 150
		}
		owner = {
		
		}
	}
}

country_event = {
	id = aleran_society.1542
	#hide_window = yes
	is_triggered_only = yes
	title = "aleran_society.1542.name"
	desc = "aleran_society.1542.desc"
	picture = GFX_evt_throne_room
	show_sound = event_factions
	
	immediate = {	
		random_playable_country = {
			limit = {
				NOT = {prev = {has_casus_belli = {target = prev type = cb_dragon}}}
			}
			save_event_target_as = receiver
		}
		random_owned_ship = {
			limit = {
				#is_ship_class = shipclass_military
			}
			save_event_target_as = deserter #for mention in the description of the option button
			set_owner = event_target:receiver
		} 
	}
	
	option = {
		name = "aleran_society.1542.click.a"
		ai_chance = {
			factor = 150
		}
		owner = {
		
		}
	}
}

country_event = {
	id = aleran_society.1550
	#hide_window = yes
	is_triggered_only = yes
	title = "aleran_society.1550.name"
	desc = "aleran_society.1550.desc"
	picture = GFX_evt_throne_room
	show_sound = event_factions
	
	immediate = {
		remove_country_flag = attacked_enclave
		from = {
			kill_leader = {
				type = ruler
				show_notification = no
			}
			kill_leader = {
				type = ruler
				show_notification = no
				heir = yes
			}
		}
		from = {
			create_leader = {
				type = governor
				species = owner_main_species
				name = random
				skill = 1
			}
			assign_leader = last_created_leader
		}
	}
	
	option = {
		name = "aleran_society.1550.click.a"
		ai_chance = {
			factor = 150
		}
		owner = {
		
		}
	}
}