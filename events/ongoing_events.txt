namespace = dragon_ongoing

country_event = {
	id = dragon_ongoing.360
	hide_window = yes
	#is_triggered_only = yes
	
	trigger = {
		NOT = {has_country_flag = is_under_war}
		any_war = {
			any_defender = { is_same_value = this }
		}
	}

	mean_time_to_happen = {
		days = 2
	}
	
	immediate = {
		set_country_flag = is_under_war
	}
}

country_event = {
	id = dragon_ongoing.361
	hide_window = yes
	#is_triggered_only = yes
	
	trigger = {
		has_country_flag = is_under_war
		NOT = {
			any_war = {
				any_defender = { is_same_value = this }
			}
		}
	}

	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		remove_country_flag = is_under_war
	}
}

country_event = {
	id = dragon_ongoing.362
	#hide_window = yes
	#is_triggered_only = yes
	title = "dragon_ongoing.362.name"
	desc = "dragon_ongoing.362.desc"
	picture = GFX_evt_unknown_ships
	show_sound = event_construction
	
	trigger = {
		NOT = {has_country_flag = aleran_expansion}
		has_valid_civic = civic_dragon_gov
		num_starbases > 25
		num_owned_planets > 5
	}

	mean_time_to_happen = {
		days = 30
	}
	
	immediate = {
		set_country_flag = aleran_expansion
	}
	
	option = {
		name = "dragon_ongoing.362.click"
		ai_chance = {
			factor = 150
		}
		owner = {
			add_modifier = {
				modifier = aleran_expansion
				days = -1
			}
		}
		
	}
}

country_event = {
	id = dragon_ongoing.363
	#hide_window = yes
	#is_triggered_only = yes
	title = "dragon_ongoing.363.name"
	desc = "dragon_ongoing.363.desc"
	picture = GFX_evt_unknown_ships
	show_sound = event_construction
	
	trigger = {
		NOT = {has_country_flag = aleran_expansion_2}
		has_technology = "tech_aleran_expansion"
	}

	mean_time_to_happen = {
		days = 30
	}
	
	immediate = {
		set_country_flag = aleran_expansion_2
	}
	
	option = {
		name = "dragon_ongoing.363.click"
		ai_chance = {
			factor = 150
		}
		owner = {
			#add_modifier = {
			#	modifier = aleran_expansion_2
			#	days = -1
			#}
			every_owned_ship = {
				limit = {
					OR = {
						is_ship_class = shipclass_colonizer
						is_ship_class = shipclass_science
						is_ship_class = shipclass_construction
					}
				}
				add_modifier = {
					modifier = aleran_expansion_2b
					days = -1
				}
			}
		}
		
	}
}

country_event = {
	id = dragon_ongoing.364
	#hide_window = yes
	#is_triggered_only = yes
	title = "dragon_ongoing.364.name"
	desc = "dragon_ongoing.364.desc"
	picture = GFX_evt_unknown_ships
	show_sound = event_construction
	
	trigger = {
		NOT = {has_country_flag = aleran_expansion_3}
		has_country_flag = aleran_expansion_2
		num_starbases > 400
		num_owned_planets > 20
	}

	mean_time_to_happen = {
		days = 30
	}
	
	immediate = {
		set_country_flag = aleran_expansion_3
	}
	
	option = {
		name = "dragon_ongoing.363.click"
		ai_chance = {
			factor = 150
		}
		owner = {
			add_modifier = {
				modifier = aleran_expansion_3
				days = -1
			}
			every_owned_ship = {
				add_modifier = {
					modifier = aleran_expansion_3b
					days = -1
				}
			}
		}
		
	}
}

country_event = {
	id = dragon_ongoing.365
	#hide_window = yes
	#is_triggered_only = yes
	title = "dragon_ongoing.365.name"
	desc = "dragon_ongoing.365.desc"
	picture = GFX_evt_unknown_ships
	show_sound = event_construction
	
	trigger = {
		NOT = {has_country_flag = aleran_ai_bonus}
		has_valid_civic = civic_dragon_gov
		is_ai = yes
	}

	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		set_country_flag = aleran_ai_bonus
		
		leader = {
			change_leader_portrait = "dgnfemale13"
		}
		
		set_city_graphical_culture = "aleran_04"
		set_graphical_culture = "plantoid_01"
		
		add_minerals = 200
		add_energy = 100
		add_influence = 100
		
		give_technology = { tech = "tech_biolab_1" message = no }
		give_technology = { tech = "tech_engineering_lab_1" message = no }
		give_technology = { tech = "tech_physics_lab_1" message = no }
		
		create_fleet = {
			effect = {
				set_owner = prev

				create_ship = {
					name = random
					random_existing_design = science
				}

				set_fleet_stance = evasive				
				#set_location = prev.capital_star
				set_location = prev.capital_scope.star
				
				owner = {
					create_leader = {
						type = scientist
						sub_type = survey
						name = random
						species = owner_main_species
					}
				}
				set_leader = last_created_leader
			}			
		}
	}
	
	option = {
		name = "dragon_ongoing.365.click"
		ai_chance = {
			factor = 150
		}
		owner = {
			add_modifier = {
				modifier = aleran_ai_bonus
				days = -1
			}
		}
		
	}
}

country_event = {
	id = dragon_ongoing.366
	hide_window = yes
	#is_triggered_only = yes
	title = "dragon_ongoing.366.name"
	desc = "dragon_ongoing.366.desc"
	picture = GFX_evt_unknown_ships
	show_sound = event_construction
	
	trigger = {
		NOT = {has_country_flag = aleran_ai_init}
		has_valid_civic = civic_dragon_gov
		is_ai = yes
	}

	mean_time_to_happen = {
		days = 4
	}
	
	immediate = {
		set_country_flag = aleran_ai_init
		
		save_event_target_as = alerans
		capital_scope = {
			solar_system = {
				save_event_target_as = aleris
			}
		}
		
		every_system = {
			limit = {
				has_star_flag = aleran_nearby
				NOT = { is_inside_border = from }
				
				#distance = {
				#	source = event_target:aleris
				#	max_distance <= 40
				#	min_distance >= 5
				#	type=euclidean
				#	use_bypasses=no
				#} 
			}
			
			every_system_planet = {
				destroy_colony = yes
				every_tile = {
					kill_pop = yes
				}				
			}
			
			create_starbase = {
				owner = event_target:alerans
				size = starbase_outpost
			} 
			starbase = {
				set_owner = event_target:alerans
			}
			
			if = {
				limit = {
					NOT = {
						distance = {
							source = event_target:aleris type=hyperlane use_bypasses=no min_jumps >= 0 max_jumps <= 2
						}
					}
				}
				add_hyperlane = { from = this to = event_target:aleris } 
			}
		}
	}
}

country_event = {
	id = dragon_ongoing.400
	#hide_window = yes
	#is_triggered_only = yes
	title = "dragon_ongoing.400.name"
	desc = "dragon_ongoing.400.desc"
	picture = GFX_evt_news_room
	show_sound = event_default
	
	trigger = {
		NOT = {has_country_flag = aleran_contact}
		NOT = {has_valid_civic = civic_dragon_gov}
		is_ai = no
		
		any_country = {
			has_valid_civic = civic_dragon_gov
			 
			has_established_contact = from
				 
			NOT = {has_casus_belli = {target = from type = cb_dragon}}
			OR = {
				is_friendly_to = FROM
				is_cordial_to = FROM
				is_protective_to = FROM
			}
		}
	}

	mean_time_to_happen = {
		days = 20
	}
	
	immediate = {
		set_country_flag = aleran_contact
	}
	
	option = {
		name = "dragon_ongoing.400.click"
		ai_chance = {
			factor = 150
		}
		owner = {
			
		}
		
	}
}

country_event = {
	id = dragon_ongoing.401
	#hide_window = yes
	#is_triggered_only = yes
	title = "dragon_ongoing.401.name"
	desc = "dragon_ongoing.401.desc"
	picture = GFX_evt_news_room
	show_sound = event_default
	
	trigger = {
		NOT = {has_country_flag = aleran_contact}
		NOT = {has_valid_civic = civic_dragon_gov}
		is_ai = no
		
		any_country = {
			has_valid_civic = civic_dragon_gov
			 
			has_established_contact = from
				 
			has_casus_belli = {target = from type = cb_dragon}
			NOR = {
				from = {
					has_ethic = ethic_fanatic_spiritualist
				}
				from = {
					has_ethic = ethic_fanatic_militarist
				}
				from = {
					has_ethic = ethic_fanatic_xenophobe
				}
			}
		}
	}

	mean_time_to_happen = {
		days = 20
	}
	
	immediate = {
		set_country_flag = aleran_contact
	}
	
	option = {
		name = "dragon_ongoing.401.click.a"
		ai_chance = {
			factor = 150
		}
		owner = {
			set_country_flag = dismissed_aleran_threat
		}
	}
	
	option = {
		name = "dragon_ongoing.401.click.b"
		ai_chance = {
			factor = 150
		}
		owner = {
			
		}
	}
	
	option = {
		name = "dragon_ongoing.401.click.c"
		ai_chance = {
			factor = 50
		}
		owner = {
			set_country_flag = considering_aleran_ideas
			add_modifier = {
				modifier = considering_aleran_ideas
				days = -1
			}
		}
	}
}

country_event = {
	id = dragon_ongoing.402
	#hide_window = yes
	#is_triggered_only = yes
	title = "dragon_ongoing.402.name"
	desc = "dragon_ongoing.402.desc"
	picture = GFX_evt_news_room
	show_sound = event_default
	
	trigger = {
		NOT = {has_country_flag = aleran_contact}
		NOT = {has_valid_civic = civic_dragon_gov}
		is_ai = no
		
		any_country = {
			has_valid_civic = civic_dragon_gov
			 
			has_established_contact = from
			
			NOT = {has_casus_belli = {target = from type = cb_dragon}}
			NOR = {
				is_friendly_to = FROM
				is_cordial_to = FROM
				is_protective_to = FROM
			}
		}
	}

	mean_time_to_happen = {
		days = 20
	}
	
	immediate = {
		set_country_flag = aleran_contact
	}
	
	option = {
		name = "dragon_ongoing.402.click.a"
		ai_chance = {
			factor = 150
		}
		owner = {
			
		}
		
	}
	
	option = {
		name = "dragon_ongoing.402.click.b"
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_militarist
					has_ethic = ethic_egalitarian
					has_ethic = ethic_spiritualist
				}
			}
		}
		ai_chance = {
			factor = 150
		}
		owner = {
			set_country_flag = planning_aleran_attack
		}
		
	}
}

country_event = {
	id = dragon_ongoing.403
	#hide_window = yes
	#is_triggered_only = yes
	title = "dragon_ongoing.403.name"
	desc = "dragon_ongoing.403.desc"
	picture = GFX_evt_news_room
	show_sound = event_default
	
	trigger = {
		NOT = {has_country_flag = aleran_contact}
		NOT = {has_valid_civic = civic_dragon_gov}
		is_ai = no
		
		any_country = {
			has_valid_civic = civic_dragon_gov
			 
			has_established_contact = from
				 
			has_casus_belli = {target = from type = cb_dragon}
			OR = {
				from = {
					has_ethic = ethic_fanatic_spiritualist
				}
				from = {
					has_ethic = ethic_fanatic_militarist
				}
				from = {
					has_ethic = ethic_fanatic_xenophobe
				}
			}
		}
	}

	mean_time_to_happen = {
		days = 20
	}
	
	immediate = {
		set_country_flag = aleran_contact
	}
	
	option = {
		name = "dragon_ongoing.403.click"
		ai_chance = {
			factor = 150
		}
		owner = {
			set_country_flag = dismissed_aleran_threat
		}
	}
}

country_event = {
	id = dragon_ongoing.800
	hide_window = yes
	#is_triggered_only = yes
	title = "dragon_ongoing.800.name"
	desc = "dragon_ongoing.800.desc"
	picture = GFX_evt_news_room
	show_sound = event_default
	
	trigger = {
		has_valid_civic = civic_dragon_gov
		is_ai = yes
		
		NOT = {has_modifier = aleran_ai_catchup}
		
		any_country = {
			NOT = {has_valid_civic = civic_dragon_gov}
			 
			has_established_contact = from
			is_ai = no
			
			NOT = {is_country_type = fallen_empire}
				 
			from = {has_casus_belli = {target = prev type = cb_dragon}}
			
			OR = {
				relative_power = {
					who = from
					category = fleet
					value > inferior
				}
				relative_power = {
					who = from
					category = technology
					value > inferior
				}
			}			
		}
	}

	mean_time_to_happen = {
		days = 120
	}
	
	immediate = {
		
	}
	
	option = {
		name = "dragon_ongoing.800.click"
		ai_chance = {
			factor = 150
		}
		owner = {
			add_modifier = {
				modifier = aleran_ai_catchup
				days = 300
			}
		}
	}
}

country_event = {
	id = dragon_ongoing.801
	hide_window = yes
	
	trigger = {
		has_valid_civic = civic_dragon_gov
		is_ai = yes
		
		NOT = {has_country_flag = aleran_ai_spacealiens}
	}

	mean_time_to_happen = {
		days = 20
	}
	
	immediate = {
		set_country_flag = aleran_ai_spacealiens
		
		country_event = { id = story.207 } #crystal pacification
		country_event = { id = story.107 } #amoeba
	}
}

country_event = {
	id = dragon_ongoing.1
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				has_country_flag = aleran_expansion_2
			}
			every_owned_ship = {
				limit = {
					OR = {
						is_ship_class = shipclass_colonizer
						is_ship_class = shipclass_science
						is_ship_class = shipclass_construction
					}
				}
				remove_modifier = aleran_expansion_2b
				add_modifier = {
					modifier = aleran_expansion_2b
					days = -1
				}
			}			
		}
		if = {
			limit = {
				has_country_flag = aleran_expansion_3
			}
			every_owned_ship = {
				remove_modifier = aleran_expansion_3b
				add_modifier = {
					modifier = aleran_expansion_3b
					days = -1
				}
			}			
		}
	}
}

planet_event = {
	id = dragon_ongoing.25
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		from = { #tile
			if = {
				limit = {
					has_building = building_hydroponics_farm_1
					planet = {
						owner = {
							has_country_flag = aleran
						}
					}
				}
				set_building = building_meat_lab_1
			}
		}
	}
}

planet_event = {
	id = dragon_ongoing.50
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		switch = {
			trigger = has_planet_flag
			tb_animals_at@from = {
				owner = {add_food = 40} #1/5 of basic stockpile limit
			}
		}
	}
}

country_event = {
	id = dragon_ongoing.1000
	hide_window = yes
	#is_triggered_only = yes
	#title = "dragon_ongoing.1000.name"
	#desc = "dragon_ongoing.1000.desc"
	#picture = GFX_evt_arguing_senate
	#show_sound = event_factions
	
	trigger = {
		has_valid_civic = civic_dragon_gov
		is_ai = yes
	}
	
	immediate = {
		if = {
			limit = {
				OR = {
					
				}
			}
			set_country_flag = already_fe_demanded
		}
		remove_modifier = humiliated
		#if = {
		#	limit = {
		#		has_country_flag = already_fe_demanded
		#	}		
			set_country_flag = fe_demand_made
		#}
		
		set_city_graphical_culture = "aleran_04"
		set_graphical_culture = "plantoid_01"
	}
	
	mean_time_to_happen = {
		days = 10
	}
	
	option = {
		name = "dragon_ongoing.1000.click"
		ai_chance = {
			factor = 150
		}		
	}
}


############--------diplomacy events------------
country_event = {
	id = dragon_ongoing.900
	hide_window = yes
	
	trigger = {
	
	}

	mean_time_to_happen = {
		days = 600
	}
	
	immediate = {
		random_playable_country = {
			limit = {
				is_country_type = default
				has_communications = root
				#NOR = {
				#	has_country_flag = aleran_cb_warning_rejected_l1
				#	has_country_flag = aleran_cb_warning_rejected_l2
				#	has_country_flag = aleran_cb_warning_rejected_l3
				#}
				root = {
					has_casus_belli = {
						target = prev type = cb_dragon
					}
				}
				NOT = {
					has_country_flag = aleran_cb_warning_accepted
				}
			}
			if = {
				limit = {
					NOR = {
						has_country_flag = aleran_cb_warning_issued_l1
						has_country_flag = aleran_cb_warning_issued_l2
						has_country_flag = aleran_cb_warning_issued_l3
					}
				}
				country_event = { id = dragon_ongoing.901 }
			}
			else_if = {
				limit = {
					has_country_flag = aleran_cb_warning_issued_l1
					NOR = {
						has_country_flag = aleran_cb_warning_issued_l2
						has_country_flag = aleran_cb_warning_issued_l3
					}
				}
				country_event = { id = dragon_ongoing.902 }
			}
			else_if = {
				limit = {
					has_country_flag = aleran_cb_warning_issued_l1
					has_country_flag = aleran_cb_warning_issued_l2
					NOT = {
						has_country_flag = aleran_cb_warning_issued_l3
					}
				}
				country_event = { id = dragon_ongoing.903 }
			}
		}
	}
}

country_event = {
	id = dragon_ongoing.901
	title = "dragon_ongoing.901.name"
	desc = "dragon_ongoing.901.desc"
	
	is_triggered_only = yes
	diplomatic = yes
	
	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}
	
	immediate = {
		set_country_flag = aleran_cb_warning_issued_l1
	}
	
	option = {
		name = "dragon_ongoing.901.click.a"
		custom_tooltip = dragon_ongoing.901.a.tooltip
		ai_chance = {
			factor = 150
		}
		owner = {
			#add_modifier = {
			#	modifier = considering_aleran_ideas
			#	days = -1
			#}
			country_event = { id = dragon_ongoing.904 }
		}
	}
	
	option = {
		name = "dragon_ongoing.901.click.b"
		ai_chance = {
			factor = 150
		}
		owner = {
		
		}
	}
	
	option = {
		name = "dragon_ongoing.901.click.c"
		custom_tooltip = dragon_ongoing.901.c.tooltip
		ai_chance = {
			factor = 150
		}
		trigger = {
			owner = {is_egalitarian = no}
			OR = {
				owner = {has_ethic = ethic_xenophobe}
				owner = {has_ethic = ethic_fanatic_xenophobe}
				owner = {has_ethic = ethic_fanatic_militarist}
			}
		}
		owner = {
			set_country_flag = aleran_cb_warning_rejected_l1
		}
	}
}

country_event = {
	id = dragon_ongoing.902
	title = "dragon_ongoing.902.name"
	desc = "dragon_ongoing.902.desc"
	
	is_triggered_only = yes
	diplomatic = yes
	
	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}
	
	immediate = {
		set_country_flag = aleran_cb_warning_issued_l2
	}
	
	option = {
		name = "dragon_ongoing.902.click.a"
		custom_tooltip = dragon_ongoing.902.a.tooltip
		ai_chance = {
			factor = 150
		}
		owner = {
			country_event = { id = dragon_ongoing.904 }
		}
	}
	
	option = {
		name = "dragon_ongoing.902.click.b"
		ai_chance = {
			factor = 150
		}
		owner = {
			
		}
	}
	
	option = {
		name = "dragon_ongoing.902.click.c"
		custom_tooltip = dragon_ongoing.902.c.tooltip
		ai_chance = {
			factor = 150
		}
		trigger = {
			owner = {is_egalitarian = no}
			OR = {
				owner = {has_ethic = ethic_xenophobe}
				owner = {has_ethic = ethic_fanatic_xenophobe}
				owner = {has_ethic = ethic_fanatic_militarist}
			}
		}
		owner = {
			set_country_flag = aleran_cb_warning_rejected_l2
		}
	}
}

country_event = {
	id = dragon_ongoing.903
	title = "dragon_ongoing.903.name"
	desc = "dragon_ongoing.903.desc"
	
	is_triggered_only = yes
	diplomatic = yes
	
	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}
	
	immediate = {
		set_country_flag = aleran_cb_warning_issued_l3
	}
	
	option = {
		name = "dragon_ongoing.903.click.a"
		custom_tooltip = dragon_ongoing.903.a.tooltip
		ai_chance = {
			factor = 150
		}
		owner = {
			country_event = { id = dragon_ongoing.904 }
		}
	}
	
	option = {
		name = "dragon_ongoing.903.click.b"
		ai_chance = {
			factor = 150
		}
		owner = {
			
		}
	}
	
	option = {
		name = "dragon_ongoing.903.click.c"
		custom_tooltip = dragon_ongoing.903.c.tooltip
		ai_chance = {
			factor = 150
		}
		trigger = {
			owner = {is_egalitarian = no}
			OR = {
				owner = {has_ethic = ethic_xenophobe}
				owner = {has_ethic = ethic_fanatic_xenophobe}
				owner = {has_ethic = ethic_fanatic_militarist}
			}
		}
		owner = {
			set_country_flag = aleran_cb_warning_rejected_l3
		}
	}
}

country_event = {
	id = dragon_ongoing.904
	is_triggered_only = yes
	#title = "dragon_ongoing.904.name"
	#desc = "dragon_ongoing.904.desc"
	#picture = GFX_evt_arguing_senate
	#show_sound = event_factions
	hide_window = yes
	
	immediate = {
		set_country_flag = aleran_cb_warning_accepted
		remove_country_flag = dismissed_aleran_threat
	}
	
	option = {
		name = "dragon_ongoing.904.click"
		ai_chance = {
			factor = 150
		}		
		owner = {
		
			save_event_target_as = us
			random_country = {
				limit = {
					has_valid_civic = civic_dragon_gov
				}
				save_event_target_as = alerans
			}
		
			copy_ethos_and_authority = event_target:alerans
			change_government = {
				civics = {
					civic = civic_dragon_listened
					civic = civic_free_haven
				}
			}
			#copy Aleran policies
			set_policy = { policy = slavery option = slavery_not_allowed cooldown = no }
			set_policy = { policy = purge option = purge_not_allowed cooldown = no }
			set_policy = { policy = pre_sapients option = pre_sapients_protect cooldown = no }
			set_policy = { policy = artificial_intelligence_policy option = ai_servitude cooldown = no }
			set_policy = { policy = first_contact_protocol option = first_contact_attack_not_allowed cooldown = no }
			set_policy = { policy = resettlement option = resettlement_allowed cooldown = no }
			set_policy = { policy = enlightenment option = enlightenment_allowed cooldown = no }
			set_policy = { policy = orbital_bombardment option = orbital_bombardment_selective cooldown = no }
			every_owned_pop_species = {
			 	set_citizenship_type = { country = event_target:us type = citizenship_full cooldown = no } 
			 	set_slavery_type = { country = event_target:us type = slavery_domestic cooldown = no } 
			 	set_living_standard = { country = event_target:us type = living_standard_good cooldown = no }
			}
		}
	}
}