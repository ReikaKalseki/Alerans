namespace = aleran_ongoing

country_event = {
	id = aleran_ongoing.1
	#hide_window = yes
	#is_triggered_only = yes
	title = "aleran_ongoing.1.name"
	desc = "aleran_ongoing.1.desc"
	picture = GFX_evt_unknown_ships
	show_sound = event_construction
	
	trigger = {
		NOT = {has_country_flag = aleran_expansion}
		has_valid_civic = civic_dragon_gov
		num_starbases > 25
		num_owned_planets > 5
	}

	mean_time_to_happen = {
		days = 30
	}
	
	immediate = {
		set_country_flag = aleran_expansion
	}
	
	option = {
		name = "aleran_ongoing.1.click"
		ai_chance = {
			factor = 150
		}
		owner = {
			add_modifier = {
				modifier = aleran_expansion
				days = -1
			}
		}
		
	}
}

country_event = {
	id = aleran_ongoing.2
	#hide_window = yes
	#is_triggered_only = yes
	title = "aleran_ongoing.2.name"
	desc = "aleran_ongoing.2.desc"
	picture = GFX_evt_unknown_ships
	show_sound = event_construction
	
	trigger = {
		NOT = {has_country_flag = aleran_expansion_2}
		has_technology = "tech_aleran_expansion"
	}

	mean_time_to_happen = {
		days = 30
	}
	
	immediate = {
		set_country_flag = aleran_expansion_2
	}
	
	option = {
		name = "aleran_ongoing.2.click"
		ai_chance = {
			factor = 150
		}
		owner = {
			#add_modifier = {
			#	modifier = aleran_expansion_2
			#	days = -1
			#}
			every_owned_ship = {
				limit = {
					OR = {
						is_ship_class = shipclass_colonizer
						is_ship_class = shipclass_science
						is_ship_class = shipclass_construction
					}
				}
				add_modifier = {
					modifier = aleran_expansion_2b
					days = -1
				}
			}
		}
		
	}
}

country_event = {
	id = aleran_ongoing.3
	#hide_window = yes
	#is_triggered_only = yes
	title = "aleran_ongoing.3.name"
	desc = "aleran_ongoing.3.desc"
	picture = GFX_evt_unknown_ships
	show_sound = event_construction
	
	trigger = {
		NOT = {has_country_flag = aleran_expansion_3}
		has_country_flag = aleran_expansion_2
		num_starbases > 400
		num_owned_planets > 20
	}

	mean_time_to_happen = {
		days = 30
	}
	
	immediate = {
		set_country_flag = aleran_expansion_3
	}
	
	option = {
		name = "aleran_ongoing.3.click"
		ai_chance = {
			factor = 150
		}
		owner = {
			add_modifier = {
				modifier = aleran_expansion_3
				days = -1
			}
			every_owned_ship = {
				add_modifier = {
					modifier = aleran_expansion_3b
					days = -1
				}
			}
		}
		
	}
}

country_event = {
	id = aleran_ongoing.4
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				has_country_flag = aleran_expansion_2
			}
			every_owned_ship = {
				limit = {
					OR = {
						is_ship_class = shipclass_colonizer
						is_ship_class = shipclass_science
						is_ship_class = shipclass_construction
					}
				}
				remove_modifier = aleran_expansion_2b
				add_modifier = {
					modifier = aleran_expansion_2b
					days = -1
				}
			}			
		}
		if = {
			limit = {
				has_country_flag = aleran_expansion_3
			}
			every_owned_ship = {
				remove_modifier = aleran_expansion_3b
				add_modifier = {
					modifier = aleran_expansion_3b
					days = -1
				}
			}
		}
	}
}

country_event = {
	id = aleran_ongoing.10
	hide_window = yes
	
	trigger = {
		has_country_flag = aleran
		has_federation = yes	
	}

	mean_time_to_happen = {
		days = 10
	}
	
	immediate = {
		set_federation_leader = this
	}
}

country_event = { #start the genocide
	id = aleran_ongoing.100
	title = "aleran_ongoing.100.name"
	desc = "aleran_ongoing.100.desc"
	picture = GFX_evt_microscopic_life
	show_sound = event_yellow_alert
	
	trigger = {
		is_ai = no
		has_country_flag = aleran
		NOR = {
			has_country_flag = genocide_bioweapon
			has_country_flag = genocide_bioweapon_ended
		}
		research_leader = {
			area = society
			exists = this
			has_level >= 4
		}
		has_lots_of_xenos = yes
	}

	mean_time_to_happen = {
		days = 3600
	}
	
	immediate = {
		set_country_flag = genocide_bioweapon
		begin_event_chain = { event_chain = genocide_bioweapon_chain target = owner }
	}
	
	option = { #identify virus
		name = "aleran_ongoing.100.click.a"
		ai_chance = {
			factor = 150
		}
		owner = {
			enable_special_project = {
				name = "identify_genocide_bioweapon"
				location = owner.capital_scope
				owner = this
			}
		}		
	}
	
	option = { #ignore, will only stop when it burns itself out
		name = "aleran_ongoing.100.click.b"
		custom_tooltip = aleran_ongoing.100.b.tooltip
		ai_chance = {
			factor = 50
		}
		owner = {
			hidden_effect = {country_event = {id = aleran_ongoing.103 days = 360 random = 180}}
		}
	}
}

country_event = { #kill a random pop and check for burnout
	id = aleran_ongoing.101
	hide_window = yes
	
	trigger = {
		has_country_flag = genocide_bioweapon
	}

	mean_time_to_happen = {
		days = 1 #was 10, then 8, then 3
	}
	
	immediate = {
		random_owned_planet = {
			limit = {
				num_pops > 2 #do not kill last 2 pops to avoid losing a colony
			}
			random_owned_pop = {
				limit = {
					NOT = {is_same_species = owner}
				}
				genocide_pop = yes
				change_variable = { which = genocided_pops value = 1 }
				prev = {
					if = {
						limit = {
							NOT = {
								has_modifier = bioweapon_death
							}
						}
						add_modifier = {
							modifier = bioweapon_death
							days = -1
						}
					}
				}
			}
		}
		if = {
			limit = {
				has_lots_of_xenos = no
				NOT = {has_country_flag = genocide_bioweapon_ended}
			}
			country_event = {id = aleran_ongoing.106 days = 5 random = 3}
		}
	}
}

country_event = { #realize it is a genocide
	id = aleran_ongoing.102
	title = "aleran_ongoing.102.name"
	desc = "aleran_ongoing.102.desc"
	picture = GFX_evt_microscopic_life
	show_sound = event_yellow_alert
	is_triggered_only = yes
	
	#trigger = {
	#	has_country_flag = genocide_bioweapon
	#	NOT = {has_country_flag = identified_genocide}
	#}

	#mean_time_to_happen = {
	#	days = 90
	#}

	immediate = {
		set_country_flag = identified_genocide
	}
	
	option = { #stop bioweapon
		name = "aleran_ongoing.102.click.a"
		ai_chance = {
			factor = 150
		}
		owner = {
			enable_special_project = {
				name = "stop_genocide_bioweapon"
				location = owner.capital_scope
				owner = this
			}
		}		
	}
	
	option = { #ignore, will only stop when it burns itself out
		name = "aleran_ongoing.102.click.b"
		custom_tooltip = aleran_ongoing.102.b.tooltip
		ai_chance = {
			factor = 50
		}
		owner = {
			set_country_flag = genocide_bioweapon_ignored #for unhappy faction
		}		
	}
}

country_event = { #realize it is a genocide without having researched
	id = aleran_ongoing.103
	title = "aleran_ongoing.103.name"
	desc = "aleran_ongoing.103.desc"
	picture = GFX_evt_microscopic_life
	show_sound = event_yellow_alert
	is_triggered_only = yes

	immediate = {
		set_country_flag = identified_genocide
	}
	
	option = { #stop bioweapon
		name = "aleran_ongoing.103.click.a"
		ai_chance = {
			factor = 150
		}
		owner = {
			enable_special_project = {
				name = "stop_genocide_bioweapon_late"
				location = owner.capital_scope
				owner = this
			}
		}		
	}
	
	option = { #ignore, will only stop when it burns itself out
		name = "aleran_ongoing.103.click.b"
		custom_tooltip = aleran_ongoing.103.b.tooltip
		ai_chance = {
			factor = 50
		}
		owner = {
			set_country_flag = genocide_bioweapon_ignored #for unhappy faction
		}		
	}
}

country_event = { #genocide progress update ("X pops dead")
	id = aleran_ongoing.104
	title = "aleran_ongoing.104.name"
	desc = "aleran_ongoing.104.desc"
	picture = GFX_evt_microscopic_life
	show_sound = event_yellow_alert
	
	trigger = {
		has_country_flag = genocide_bioweapon
		has_country_flag = identified_genocide
	}

	mean_time_to_happen = {
		days = 90
	}

	immediate = {
		
	}
	
	option = {
		name = "aleran_ongoing.104.click"
		ai_chance = {
			factor = 150
		}
		owner = {
			
		}		
	}
}

country_event = { #bioweapon neutralized via special project, search for the culprit
	id = aleran_ongoing.105
	title = "aleran_ongoing.105.name"
	desc = "aleran_ongoing.105.desc"
	picture = GFX_evt_microscopic_life
	show_sound = event_celebration
	is_triggered_only = yes

	immediate = {
		set_country_flag = genocide_bioweapon_ended
		set_country_flag = genocide_bioweapon_stopped
		remove_country_flag = genocide_bioweapon
		every_owned_planet = {
			remove_modifier = bioweapon_death
		}
		country_event = {id = aleran_ongoing.107 days = 60 random = 30}
	}
	
	option = {
		name = "aleran_ongoing.105.click"
		ai_chance = {
			factor = 150
		}
		owner = {
			
		}		
	}
}

country_event = { #bioweapon burned itself out, search for the culprit
	id = aleran_ongoing.106
	title = "aleran_ongoing.106.name"
	desc = "aleran_ongoing.106.desc"
	picture = GFX_evt_microscopic_life
	show_sound = event_yellow_alert
	is_triggered_only = yes

	immediate = {
		set_country_flag = genocide_bioweapon_ended
		remove_country_flag = genocide_bioweapon
		every_owned_planet = {
			remove_modifier = bioweapon_death
		}
		add_modifier = {
			modifier = bioweapon_not_stopped
			days = 3600
		}
		if = {
			limit = {
				NOR = {
					is_researching_special_project = identify_genocide_bioweapon
					is_researching_special_project = stop_genocide_bioweapon
				}
			}
			set_country_flag = genocide_bioweapon_ignored
		}
		abort_special_project = { type = identify_genocide_bioweapon location = owner.capital_scope }
		abort_special_project = { type = stop_genocide_bioweapon location = owner.capital_scope }
		abort_special_project = { type = stop_genocide_bioweapon_late location = owner.capital_scope }
		country_event = {id = aleran_ongoing.107 days = 60 random = 30}
	}
	
	option = {
		name = "aleran_ongoing.106.click"
		ai_chance = {
			factor = 150
		}
		owner = {
			
		}		
	}
}

country_event = { #found the scientist, what do we do with them?
	id = aleran_ongoing.107
	title = "aleran_ongoing.107.name"
	desc = "aleran_ongoing.107.desc"
	picture = GFX_evt_microscopic_life
	show_sound = event_yellow_alert
	is_triggered_only = yes

	immediate = {
		set_country_flag = genocide_culprit_found
		
		every_owned_leader = {
			if = {
				limit = {
					owner = {
						research_leader = {
							area = society
							is_same_value = prevprev
						}
					}
				}
				save_event_target_as = murderer
			}
		}
	}
	
	option = {
		name = "aleran_ongoing.107.click.a" #do nothing, queuing a repeat in the future
		custom_tooltip = aleran_ongoing.107.a.tooltip
		ai_chance = {
			factor = 150
		}
		owner = {
			hidden_effect = {country_event = {id = aleran_ongoing.108 days = 720 random = 360}}
		}		
	}
	
	option = {
		name = "aleran_ongoing.107.click.b" #kill them
		ai_chance = {
			factor = 150
		}
		owner = {
			event_target:murderer = {
				kill_leader = { show_notification = yes }
			}
			end_event_chain = genocide_bioweapon_chain
		}		
	}
}

country_event = { #they did it again
	id = aleran_ongoing.108
	title = "aleran_ongoing.108.name"
	desc = "aleran_ongoing.108.desc"
	picture = GFX_evt_microscopic_life
	show_sound = event_yellow_alert
	is_triggered_only = yes

	immediate = {
		every_owned_planet = {
			limit = {
				num_pops > 2 #do not kill last 2 pops to avoid losing a colony
			}
			every_owned_pop = {
				limit = {
					NOT = {is_same_species = owner}
				}
				random_list = {
					50 = {genocide_pop = yes}
					50 = {}
				}
			}
		}
	}
	
	option = {
		name = "aleran_ongoing.108.click" #kill them
		ai_chance = {
			factor = 150
		}
		owner = {
			every_owned_leader = {
				if = {
					limit = {
						owner = {
							research_leader = {
								area = society
								is_same_value = prevprev
							}
						}
					}
					kill_leader = { show_notification = yes }
				}
			}
			end_event_chain = genocide_bioweapon_chain
		}		
	}
}

country_event = { #the star does something funny
	id = aleran_ongoing.200
	title = "aleran_ongoing.200.name"
	desc = "aleran_ongoing.200.desc"
	picture = GFX_evt_solar_flare
	show_sound = event_solar_fusion
	
	trigger = {
		is_ai = no
		has_country_flag = aleran
		NOT = {exists = event_target:solar_storm_planet}
		NOR = {
			has_country_flag = solar_storm
			has_country_flag = solar_storm_ended
		}
		any_planet_within_border = { 
			exists = owner
			owner = {
				is_primitive = yes
			}
		}
	}

	mean_time_to_happen = {
		days = 3600
	}
	
	immediate = {
		set_country_flag = solar_storm
		save_global_event_target_as = alerans
		begin_event_chain = { event_chain = solar_storm_chain target = owner }
		
		random_planet_within_border = {
			limit = {
				exists = owner
				owner = {
					is_primitive = yes
				}
			}
			save_global_event_target_as = solar_storm_planet
		
			planet_event = {id = aleran_ongoing.204 days = 20 random = 5} #queue some "preshocks"
			planet_event = {id = aleran_ongoing.204 days = 30 random = 5}
			planet_event = {id = aleran_ongoing.204 days = 40 random = 15}
			planet_event = {id = aleran_ongoing.204 days = 60 random = 15}
			planet_event = {id = aleran_ongoing.204 days = 80 random = 15}
			planet_event = {id = aleran_ongoing.205 days = 100 random = 15} #some bigger events
			planet_event = {id = aleran_ongoing.205 days = 120 random = 20}
			planet_event = {id = aleran_ongoing.205 days = 150 random = 20}
			planet_event = {id = aleran_ongoing.206 days = 180 random = 30} #queue the storm
		}
	}
	
	option = { #investigate further
		name = "aleran_ongoing.200.click.a"
		ai_chance = {
			factor = 150
		}
		owner = {
			enable_special_project = {
				name = "investigate_solar_storm"
				location = event_target:solar_storm_planet
				owner = this
			}
		}		
	}
	
	option = { #ignore
		name = "aleran_ongoing.200.click.b"
		custom_tooltip = aleran_ongoing.200.b.tooltip
		ai_chance = {
			factor = 50
		}
		owner = {
			
		}
	}
}

country_event = { #realize upcoming solar event
	id = aleran_ongoing.202
	title = "aleran_ongoing.202.name"
	desc = "aleran_ongoing.202.desc"
	picture = GFX_evt_solar_flare
	show_sound = event_solar_fusion
	is_triggered_only = yes

	immediate = {
		set_country_flag = identified_solar_storm
	}
	
	option = { #build shield
		name = "aleran_ongoing.202.click.a"
		ai_chance = {
			factor = 150
		}
		owner = {
			enable_special_project = {
				name = "build_solar_shield"
				location = event_target:solar_storm_planet
				owner = this
			}
			add_modifier = {
				modifier = building_shield
				days = -1
			}
		}		
	}
	
	option = { #ignore, let them die
		name = "aleran_ongoing.202.click.b"
		custom_tooltip = aleran_ongoing.202.b.tooltip
		ai_chance = {
			factor = 50
		}
		owner = {
			set_country_flag = solar_storm_ignored #for unhappy faction
		}		
	}
}

country_event = { #finish the shield so that the storm is harmless
	id = aleran_ongoing.203
	title = "aleran_ongoing.203.name"
	desc = "aleran_ongoing.203.desc"
	picture = GFX_evt_solar_flare
	show_sound = event_solar_fusion
	is_triggered_only = yes

	immediate = {
		set_country_flag = solar_storm_shielded
	}
	
	option = {
		name = "aleran_ongoing.203.click"
		ai_chance = {
			factor = 150
		}
		owner = {
			remove_modifier = building_shield
		}		
	}
}

planet_event = { #preshocks 1
	id = aleran_ongoing.204
	title = "aleran_ongoing.204.name"
	desc = "aleran_ongoing.204.desc"
	picture = GFX_evt_solar_flare
	show_sound = event_solar_fusion
	is_triggered_only = yes

	immediate = {
		
	}
	
	option = {
		name = "aleran_ongoing.204.click"
		ai_chance = {
			factor = 150
		}
		owner = {
			
		}		
	}
}

planet_event = { #preshocks 2
	id = aleran_ongoing.205
	title = "aleran_ongoing.205.name"
	desc = "aleran_ongoing.205.desc"
	picture = GFX_evt_solar_flare
	show_sound = event_solar_fusion
	is_triggered_only = yes

	immediate = {
		
	}
	
	option = {
		name = "aleran_ongoing.205.click"
		ai_chance = {
			factor = 150
		}
		owner = {
			
		}		
	}
}

planet_event = { #storm fork
	id = aleran_ongoing.206
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		event_target:alerans = {
			set_country_flag = solar_storm_ended
			remove_country_flag = solar_storm
			remove_modifier = building_shield
		}
		solar_system = {
			every_fleet_in_system = {
				destroy_fleet = this
			}
		}
		if = {
			limit = {
				event_target:alerans = {
					has_country_flag = solar_storm_shielded
				}
			}
			planet_event = {id = aleran_ongoing.207 days = 1}
		}
		else = {
			planet_event = {id = aleran_ongoing.208 days = 1}
		}
	}
}

planet_event = { #storm, with protection
	id = aleran_ongoing.207
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		event_target:alerans = {
			country_event = {id = aleran_ongoing.209 days = 1}
		}
		add_modifier = {
			modifier = shielded_storm
			days = 180
		}
		owner = {
			if = {
				limit = {
					#has_country_flag = industrial_age
					#has_country_flag = machine_age
					has_country_flag = atomic_age
					has_country_flag = early_space_age
				}
				#set_primitive_age = industrial_age
				set_primitive_age = atomic_age
			}
		}
	}
}

planet_event = { #storm, no protection
	id = aleran_ongoing.208
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		event_target:alerans = {
			country_event = {id = aleran_ongoing.210 days = 1}
		}
		add_modifier = {
			modifier = unshielded_storm
			days = 360
		}
		every_tile = {
			kill_pop = yes
			random_list = {
				10 = {remove_building = yes}
				35 = {set_ruined = yes}
				55 = {}
			}
		}
		destroy_colony = yes
	}
}

country_event = { #protected dialog box
	id = aleran_ongoing.209
	title = "aleran_ongoing.209.name"
	desc = "aleran_ongoing.209.desc"
	picture = GFX_evt_solar_flare
	show_sound = event_solar_fusion
	is_triggered_only = yes

	immediate = {
	
	}
	
	option = {
		name = "aleran_ongoing.209.click"
		ai_chance = {
			factor = 150
		}
		end_event_chain = solar_storm_chain
		clear_global_event_target = alerans
		clear_global_event_target = solar_storm_planet
	}
}

country_event = { #unprotected dialog box
	id = aleran_ongoing.210
	title = "aleran_ongoing.210.name"
	desc = "aleran_ongoing.210.desc"
	picture = GFX_evt_solar_flare
	show_sound = event_solar_fusion
	is_triggered_only = yes

	immediate = {
		
	}
	
	option = {
		name = "aleran_ongoing.210.click"
		ai_chance = {
			factor = 150
		}
		set_country_flag = solar_storm_ignored #for unhappy faction
		end_event_chain = solar_storm_chain	
		clear_global_event_target = alerans
		clear_global_event_target = solar_storm_planet
	}
}